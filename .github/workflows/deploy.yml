name: Deploy (demo)

on:
  workflow_dispatch:
    inputs:
      target_env:
        description: "Where to deploy"
        type: choice
        required: true
        options:
          - dev
          - prod
      mode:
        description: "What to do"
        type: choice
        required: true
        options:
          - plan
          - apply

permissions:
  contents: read

jobs:
  deploy:
    name: ${{ inputs.mode }} to ${{ inputs.target_env }}
    runs-on: ubuntu-latest
    environment: ${{ inputs.target_env }}

    steps:
      - uses: actions/checkout@v4

      - name: Show deployment context
        run: |
          echo "Mode:        ${{ inputs.mode }}"
          echo "Environment: ${{ inputs.target_env }}"
          echo "Actor:       $GITHUB_ACTOR"
          echo "Ref:         $GITHUB_REF"

      - name: Simulate plan
        if: inputs.mode == 'plan'
        run: |
          echo "✅ PLAN: generating a preview of changes (no real changes made)"

      - name: Simulate apply (uses secret)
        if: inputs.mode == 'apply'
        env:
          DEMO_TOKEN: ${{ secrets.DEMO_TOKEN }}
        run: |
          echo "✅ APPLY: executing deployment using protected env secrets"
          echo "Token length: ${#DEMO_TOKEN}"
